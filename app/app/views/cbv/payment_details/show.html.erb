<% case @flow %>
<% when ActivityFlow %>
  <% header = employer_name ? t(".activity_flow.header", employer_name: employer_name) : t(".activity_flow.header_no_employer_name") %>
<% else %>
  <% header = employer_name ? t(".header", employer_name: employer_name) : t(".header_no_employer_name") %>
<% end %>

<% content_for :title, header %>
<h1>
  <%= header %>
</h1>

<% case @flow %>
<% when ActivityFlow %>
  <%= t(".activity_flow.subheader_html",
      start_date: format_date(@aggregator_report.from_date),
      end_date: format_date(@aggregator_report.to_date),
      agency_acronym: agency_translation("shared.agency_acronym"),
    ) %>
<% else %>
  <%= t(".subheader_html",
      start_date: format_date(@aggregator_report.from_date),
      end_date: format_date(@aggregator_report.to_date),
      agency_acronym: agency_translation("shared.agency_acronym"),
      report_data_range: report_data_range(@aggregator_report, params[:user][:account_id])
    ) %>
<% end %>

<%= render(Report::EmploymentDetailsTableComponent.new(@aggregator_report, @payroll_account, show_income: @is_w2_worker)) %>

<% if @is_w2_worker %>
  <% if @payroll_account_report.paystubs.any? %>
    <%= render(Report::W2MonthlySummaryTableComponent.new(@aggregator_report, @payroll_account)) %>
  <% else %>
    <%= render Uswds::Alert.new(type: :info, heading: t(".none_found", report_data_range: report_data_range(@aggregator_report, params[:user][:account_id])), class: "margin-top-5") do %>
      <%= t(".none_found_description", report_data_range: report_data_range(@aggregator_report, params[:user][:account_id])) %>
    <% end %>
  <% end %>
  <%= render(Report::PaymentsDeductionsMonthlySummaryComponent.new(@aggregator_report, @payroll_account, is_w2_worker: @is_w2_worker, pay_frequency_text: pay_frequency)) %>
<% else %>
  <%= render(Report::GigMonthlySummaryTableComponent.new(@aggregator_report, @payroll_account)) %>
<% end %>

<div class="usa-form-group margin-top-5">
  <h2><%= t(".additional_information_header") %></h2>
  <%= form_with(model: @payroll_account, url: @payment_details_path, method: :patch, class: "usa-form usa-form--large") do |form| %>
    <%= hidden_field_tag "user[account_id]", params[:user][:account_id] %>

    <% case @flow %>
    <% when ActivityFlow %>
      <% additional_information_label = t(".activity_flow.additional_information_label", agency_acronym: agency_translation("shared.agency_acronym")) %>
    <% else %>
      <% additional_information_label = t(".additional_information_label", agency_acronym: agency_translation("shared.agency_acronym")) %>
    <% end %>
    <%= form.label :additional_information, additional_information_label, class: "usa-label" %>
    <%= form.text_area :additional_information, class: "usa-textarea", rows: 5 %>
    <%= form.submit t(".continue"), class: "usa-button usa-button--primary" %>
  <% end %>
</div>
