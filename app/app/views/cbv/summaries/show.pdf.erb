<h1>
  <%= t(".header") %>
</h1>

<% if @payments.any? %>
  <div class="width-full margin-bottom-6">
    <p>
      <%= t(".description", summary_start_date: @summary_start_date, summary_end_date: @summary_end_date) %>
    </p>
    <h2 class="site-preview-heading"><%= t(".total_payments", amount: format_money(total_gross_income)) %></h2>
    <p><%= t(".total_payments_desc") %></p>

    <table class="usa-table usa-table--borderless width-full">
      <thead class="border-top-05">
        <tr>
          <th class="padding-3" style="background-color: #d9e8f6;" colspan="2">
            <h3 class="margin-0"><%= t(".employment_information_table_header") %></h3>
          </th>
        </tr>
      </thead>
      <tbody>
        <% if @cbv_flow.confirmation_code.present? %>
          <tr>
            <td><%= t(".confirmation_code") %></td>
            <td><%= @cbv_flow.confirmation_code %></td>
          </tr>
        <% end %>
        <tr>
          <td><%= t(".application_or_recertification_date") %></td>
          <td><%= format_date(@cbv_flow.cbv_flow_invitation.snap_application_date) %></td>
        </tr>
        <tr>
          <td><%= t(".report_created_at") %></td>
          <td><%= format_date(@cbv_flow.consented_to_authorized_use_at) %></td>
        </tr>
        <tr>
          <td><%= t(".date_range") %></td>
          <td><%= format_date(@cbv_flow.cbv_flow_invitation.paystubs_query_begins_at) %> to <%= format_date(@cbv_flow.cbv_flow_invitation.snap_application_date) %></td>
        </tr>
      </tbody>
    </table>

    <% payments_grouped_by_employer.each_with_index do |(account_id, summary), index| %>
      <table class="usa-table usa-table--borderless width-full">
        <h3>
          <% if summary[:employer_name] %>
            <%= t(".table_caption", number: index, employer_name: summary[:employer_name]) %>
          <% else %>
            <%= t(".table_caption_no_name", number: index + 1) %>
          <% end %>
        </h3>
        <thead class="border-top-05">
          <tr>
            <th class="padding-3" style="background-color: #d9e8f6;" colspan="2">
              <h4 class="margin-0">
                <% if summary[:employer_name] %>
                  <%= t(".total_income_from", employer_name: summary[:employer_name], amount: summary[:total]) %>
                <% else %>
                  <%= t(".total_income_from_no_employer_name", amount: format_money(summary[:total])) %>
                <% end %>
              </h4>
            </th>
          </tr>
        </thead>
        <tbody>
          <% summary[:payments].each do |payment| %>
            <tr>
              <td><%= t(".payment", amount: format_money(payment[:gross_pay_amount]), date: format_date_string(payment[:pay_date])) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <h4><%= t(".additional_comments") %></h4>
      <%= get_comment_by_account_id(account_id).dig("comment") != "" ? get_comment_by_account_id(account_id).dig("comment") : t("shared.not_applicable") %>
    <% end %>
  </div>
<% else %>
  <h3 class="site-preview-heading">
    <%= t(".none_found") %>
  </h3>
<% end %>
