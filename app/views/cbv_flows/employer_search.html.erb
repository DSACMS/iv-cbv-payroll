<% content_for :head do %>
  <%= tag :meta, name: :argyle_user_token, content: @argyle_user_token %>
  <%= tag :meta, name: :argyle_sandbox, content: ENV['ARGYLE_SANDBOX'] %>
<% end %>

<h2>Get payment info from your employer.</h2>

<div data-controller="cbv-flows">
  <h3 class="site-preview-heading">Search for an employer</h3>
  <%= form_with url: cbv_flow_employer_search_path, method: :get, class: 'usa-search usa-search--big', html: { role: 'search' }, data: { turbo_frame: 'employers', turbo_action: 'advance' } do |f| %>
    <%= f.label :query, "Search for your employer", class: "usa-sr-only" %>
    <%= f.text_field :query, value: @query, class: "usa-input", type: 'search', data: { "cbv-flows-target": "searchTerms" } %>
    <button
      class="usa-button"
      type="submit"
    >
      <span class="usa-search__submit-text">
        Search
      </span>
      <%= image_tag "@uswds/uswds/dist/img/usa-icons-bg/search--white.svg", class: "usa-search__submit-icon", alt: "Search" %>
    </button>
  <% end %>

  <h3 class="site-preview-heading margin-bottom-2">Results</h3>
  <%= render partial: 'employer', locals: { employer: @employers } %>

  <%= form_with url: cbv_flow_summary_path, method: :post, class: 'display-none', data: { 'cbv-flows-target': "form" } do |f| %>
    <input type="hidden" name="user[account_id]" data-cbv-flows-target="userAccountId" />
  <% end %>

  <a
    href="#data-fetching-modal"
    class="display-none"
    aria-controls="data-fetching-modal"
    data-open-modal
    data-cbv-flows-target="modal"
  ></a>
  <div class="margin-y-3">
    <div
      class="usa-modal"
      id="data-fetching-modal"
      aria-labelledby="modal-3-heading"
      aria-describedby="modal-3-description"
      data-force-action
    >
      <div class="usa-modal__content">
        <div class="usa-modal__main">
          <h2 class="usa-modal__heading" id="modal-3-heading">
            We are fetching your employer's payment information.
          </h2>
          <div class="usa-prose">
            <p id="modal-3-description">
              This may take a few minutes. Please do not close this window.
            </p>
          </div>
          <div class="lds-ripple" style="left: 30%;"><div></div><div></div></div>
        </div>
      </div>
    </div>
  </div>
</div>
